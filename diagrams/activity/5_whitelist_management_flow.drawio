<mxfile host="app.diagrams.net">
  <diagram id="whitelist-management-flow" name="Whitelist Management Flow">
    <mxGraphModel dx="1422" dy="794" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />

        <!-- TiÃªu Ä‘á» -->
        <mxCell id="title" value="SÆ¡ Äá»“ Luá»“ng Quáº£n LÃ½ Danh SÃ¡ch Email ÄÆ°á»£c PhÃ©p&#xa;(Whitelist Management Flow)" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=16;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="164" y="20" width="500" height="40" as="geometry" />
        </mxCell>

        <!-- SECTION 1: ADD EMAIL TO WHITELIST -->
        <mxCell id="section1-label" value="ðŸ“ THÃŠM EMAIL VÃ€O WHITELIST" style="text;html=1;strokeColor=#666666;fillColor=#f5f5f5;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=1;fontStyle=1;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="40" y="80" width="340" height="30" as="geometry" />
        </mxCell>

        <!-- Start Add -->
        <mxCell id="start-add" value="Báº¯t Ä‘áº§u&#xa;ThÃªm Email" style="ellipse;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="160" y="130" width="100" height="60" as="geometry" />
        </mxCell>

        <!-- Admin input email -->
        <mxCell id="admin-input" value="Admin nháº­p email&#xa;cáº§n thÃªm vÃ o whitelist&#xa;+ notes (tÃ¹y chá»n)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="140" y="220" width="140" height="70" as="geometry" />
        </mxCell>

        <!-- Call API add -->
        <mxCell id="call-add-api" value="POST /api/v1/&#xa;whitelist/add&#xa;{email, added_by, notes}" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="140" y="320" width="140" height="70" as="geometry" />
        </mxCell>

        <!-- Check localhost -->
        <mxCell id="check-localhost-add" value="Kiá»ƒm tra request&#xa;tá»« localhost?" style="rhombus;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="145" y="420" width="130" height="90" as="geometry" />
        </mxCell>

        <!-- Hash email -->
        <mxCell id="hash-email-add" value="Hash email&#xa;báº±ng SHA-256&#xa;(báº£o máº­t)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="140" y="540" width="140" height="60" as="geometry" />
        </mxCell>

        <!-- Insert DB -->
        <mxCell id="insert-db" value="INSERT vÃ o database&#xa;email_whitelist:&#xa;- email_hash (unique)&#xa;- email_encrypted&#xa;- is_active=true" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="140" y="630" width="140" height="90" as="geometry" />
        </mxCell>

        <!-- Check duplicate -->
        <mxCell id="check-duplicate" value="Email Ä‘Ã£&#xa;tá»“n táº¡i?" style="rhombus;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="145" y="750" width="130" height="90" as="geometry" />
        </mxCell>

        <!-- Duplicate error -->
        <mxCell id="duplicate-error" value="Tráº£ vá» 409 Conflict&#xa;Email already exists" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="310" y="765" width="120" height="60" as="geometry" />
        </mxCell>

        <!-- Success add -->
        <mxCell id="success-add" value="Tráº£ vá» 201 Created&#xa;vá»›i whitelist entry" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="150" y="870" width="120" height="60" as="geometry" />
        </mxCell>

        <!-- End add -->
        <mxCell id="end-add" value="Káº¿t thÃºc" style="ellipse;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="165" y="960" width="90" height="50" as="geometry" />
        </mxCell>

        <!-- SECTION 2: CHECK EMAIL WHITELIST -->
        <mxCell id="section2-label" value="ðŸ” KIá»‚M TRA EMAIL TRONG WHITELIST" style="text;html=1;strokeColor=#666666;fillColor=#f5f5f5;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=1;fontStyle=1;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="440" y="80" width="340" height="30" as="geometry" />
        </mxCell>

        <!-- Start check -->
        <mxCell id="start-check" value="Báº¯t Ä‘áº§u&#xa;Kiá»ƒm Tra" style="ellipse;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="565" y="130" width="90" height="60" as="geometry" />
        </mxCell>

        <!-- During callback -->
        <mxCell id="during-callback" value="Trong quÃ¡ trÃ¬nh&#xa;OAuth callback&#xa;(sau khi user login Google)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="545" y="220" width="130" height="70" as="geometry" />
        </mxCell>

        <!-- Get user email -->
        <mxCell id="get-email" value="Láº¥y email&#xa;tá»« Google OAuth" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="545" y="320" width="130" height="60" as="geometry" />
        </mxCell>

        <!-- Hash email check -->
        <mxCell id="hash-email-check" value="Hash email&#xa;báº±ng SHA-256" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="545" y="410" width="130" height="60" as="geometry" />
        </mxCell>

        <!-- Query DB -->
        <mxCell id="query-db" value="SELECT COUNT(*)&#xa;FROM email_whitelist&#xa;WHERE email_hash=?&#xa;AND is_active=true" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="545" y="500" width="130" height="80" as="geometry" />
        </mxCell>

        <!-- Check result -->
        <mxCell id="check-result" value="Count > 0?" style="rhombus;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="560" y="610" width="100" height="80" as="geometry" />
        </mxCell>

        <!-- Not whitelisted -->
        <mxCell id="not-whitelisted" value="Tráº£ vá» 403&#xa;Access Denied&#xa;Email chÆ°a Ä‘Æ°á»£c&#xa;cáº¥p quyá»n" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="705" y="625" width="110" height="70" as="geometry" />
        </mxCell>

        <!-- Whitelisted -->
        <mxCell id="whitelisted" value="Email há»£p lá»‡!&#xa;Tiáº¿p tá»¥c táº¡o&#xa;JWT token vÃ  session" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="555" y="720" width="110" height="70" as="geometry" />
        </mxCell>

        <!-- End check -->
        <mxCell id="end-check" value="Káº¿t thÃºc" style="ellipse;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="570" y="820" width="80" height="50" as="geometry" />
        </mxCell>

        <!-- SECTION 3: LIST WHITELISTED EMAILS -->
        <mxCell id="section3-label" value="ðŸ“‹ LIá»†T KÃŠ DANH SÃCH WHITELIST" style="text;html=1;strokeColor=#666666;fillColor=#f5f5f5;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=1;fontStyle=1;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="40" y="1050" width="340" height="30" as="geometry" />
        </mxCell>

        <!-- Start list -->
        <mxCell id="start-list" value="Báº¯t Ä‘áº§u&#xa;Láº¥y DS" style="ellipse;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="160" y="1100" width="100" height="60" as="geometry" />
        </mxCell>

        <!-- Admin request list -->
        <mxCell id="admin-request-list" value="Admin/User yÃªu cáº§u&#xa;xem danh sÃ¡ch whitelist" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="140" y="1190" width="140" height="60" as="geometry" />
        </mxCell>

        <!-- Call list API -->
        <mxCell id="call-list-api" value="GET /api/v1/&#xa;whitelist/list" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="140" y="1280" width="140" height="60" as="geometry" />
        </mxCell>

        <!-- Check localhost list -->
        <mxCell id="check-localhost-list" value="Kiá»ƒm tra&#xa;localhost?" style="rhombus;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="155" y="1370" width="110" height="80" as="geometry" />
        </mxCell>

        <!-- Query all -->
        <mxCell id="query-all" value="SELECT * FROM&#xa;email_whitelist&#xa;ORDER BY&#xa;created_at DESC" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="140" y="1480" width="140" height="80" as="geometry" />
        </mxCell>

        <!-- Return list -->
        <mxCell id="return-list" value="Tráº£ vá» JSON array&#xa;vá»›i danh sÃ¡ch emails&#xa;(email Ä‘Æ°á»£c mÃ£ hÃ³a)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="140" y="1590" width="140" height="70" as="geometry" />
        </mxCell>

        <!-- End list -->
        <mxCell id="end-list" value="Káº¿t thÃºc" style="ellipse;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="165" y="1690" width="90" height="50" as="geometry" />
        </mxCell>

        <!-- SECTION 4: REMOVE EMAIL -->
        <mxCell id="section4-label" value="ðŸ—‘ï¸ XÃ“A EMAIL KHá»ŽI WHITELIST" style="text;html=1;strokeColor=#666666;fillColor=#f5f5f5;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=1;fontStyle=1;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="440" y="920" width="340" height="30" as="geometry" />
        </mxCell>

        <!-- Start remove -->
        <mxCell id="start-remove" value="Báº¯t Ä‘áº§u&#xa;XÃ³a Email" style="ellipse;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="565" y="970" width="90" height="60" as="geometry" />
        </mxCell>

        <!-- Admin select remove -->
        <mxCell id="admin-select-remove" value="Admin chá»n email&#xa;cáº§n xÃ³a (by ID)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="545" y="1060" width="130" height="60" as="geometry" />
        </mxCell>

        <!-- Call remove API -->
        <mxCell id="call-remove-api" value="DELETE /api/v1/&#xa;whitelist/remove/{id}" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="545" y="1150" width="130" height="60" as="geometry" />
        </mxCell>

        <!-- Check localhost remove -->
        <mxCell id="check-localhost-remove" value="Kiá»ƒm tra&#xa;localhost?" style="rhombus;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="560" y="1240" width="100" height="80" as="geometry" />
        </mxCell>

        <!-- Delete from DB -->
        <mxCell id="delete-db" value="DELETE FROM&#xa;email_whitelist&#xa;WHERE id=?" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="545" y="1350" width="130" height="70" as="geometry" />
        </mxCell>

        <!-- Check deleted -->
        <mxCell id="check-deleted" value="Rows affected&#xa;> 0?" style="rhombus;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="560" y="1450" width="100" height="80" as="geometry" />
        </mxCell>

        <!-- Not found -->
        <mxCell id="not-found" value="Tráº£ vá» 404&#xa;Email not found" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="705" y="1465" width="110" height="50" as="geometry" />
        </mxCell>

        <!-- Success remove -->
        <mxCell id="success-remove" value="Tráº£ vá» success&#xa;Email removed" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="555" y="1560" width="110" height="50" as="geometry" />
        </mxCell>

        <!-- End remove -->
        <mxCell id="end-remove" value="Káº¿t thÃºc" style="ellipse;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="570" y="1640" width="80" height="50" as="geometry" />
        </mxCell>

        <!-- SECTION 5: UPDATE EMAIL STATUS -->
        <mxCell id="section5-label" value="âœï¸ Cáº¬P NHáº¬T TRáº NG THÃI EMAIL" style="text;html=1;strokeColor=#666666;fillColor=#f5f5f5;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=1;fontStyle=1;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="440" y="1730" width="340" height="30" as="geometry" />
        </mxCell>

        <!-- Start update -->
        <mxCell id="start-update" value="Báº¯t Ä‘áº§u&#xa;Cáº­p Nháº­t" style="ellipse;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="565" y="1780" width="90" height="60" as="geometry" />
        </mxCell>

        <!-- Admin update -->
        <mxCell id="admin-update" value="Admin thay Ä‘á»•i:&#xa;- is_active (báº­t/táº¯t)&#xa;- notes" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="545" y="1870" width="130" height="70" as="geometry" />
        </mxCell>

        <!-- Call update API -->
        <mxCell id="call-update-api" value="PUT /api/v1/&#xa;whitelist/update/{id}&#xa;{is_active, notes}" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="545" y="1970" width="130" height="70" as="geometry" />
        </mxCell>

        <!-- Update DB -->
        <mxCell id="update-db" value="UPDATE&#xa;email_whitelist&#xa;SET is_active=?,&#xa;notes=?, updated_at&#xa;WHERE id=?" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="545" y="2070" width="130" height="90" as="geometry" />
        </mxCell>

        <!-- Return updated -->
        <mxCell id="return-updated" value="Tráº£ vá» entry&#xa;Ä‘Ã£ cáº­p nháº­t" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="555" y="2190" width="110" height="50" as="geometry" />
        </mxCell>

        <!-- End update -->
        <mxCell id="end-update" value="Káº¿t thÃºc" style="ellipse;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="570" y="2270" width="80" height="50" as="geometry" />
        </mxCell>

        <!-- Arrows Section 1 -->
        <mxCell id="arrow1-1" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="start-add" target="admin-input">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow1-2" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="admin-input" target="call-add-api">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow1-3" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="call-add-api" target="check-localhost-add">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow1-4" value="CÃ³" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="check-localhost-add" target="hash-email-add">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow1-5" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="hash-email-add" target="insert-db">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow1-6" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="insert-db" target="check-duplicate">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow1-7" value="CÃ³" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="check-duplicate" target="duplicate-error">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow1-8" value="KhÃ´ng" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="check-duplicate" target="success-add">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow1-9" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="success-add" target="end-add">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Arrows Section 2 -->
        <mxCell id="arrow2-1" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="start-check" target="during-callback">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow2-2" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="during-callback" target="get-email">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow2-3" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="get-email" target="hash-email-check">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow2-4" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="hash-email-check" target="query-db">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow2-5" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="query-db" target="check-result">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow2-6" value="KhÃ´ng" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="check-result" target="not-whitelisted">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow2-7" value="CÃ³" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="check-result" target="whitelisted">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow2-8" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="whitelisted" target="end-check">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Arrows Section 3 -->
        <mxCell id="arrow3-1" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="start-list" target="admin-request-list">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow3-2" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="admin-request-list" target="call-list-api">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow3-3" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="call-list-api" target="check-localhost-list">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow3-4" value="CÃ³" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="check-localhost-list" target="query-all">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow3-5" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="query-all" target="return-list">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow3-6" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="return-list" target="end-list">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Arrows Section 4 -->
        <mxCell id="arrow4-1" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="start-remove" target="admin-select-remove">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow4-2" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="admin-select-remove" target="call-remove-api">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow4-3" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="call-remove-api" target="check-localhost-remove">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow4-4" value="CÃ³" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="check-localhost-remove" target="delete-db">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow4-5" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="delete-db" target="check-deleted">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow4-6" value="KhÃ´ng" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="check-deleted" target="not-found">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow4-7" value="CÃ³" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="check-deleted" target="success-remove">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow4-8" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="success-remove" target="end-remove">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Arrows Section 5 -->
        <mxCell id="arrow5-1" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="start-update" target="admin-update">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow5-2" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="admin-update" target="call-update-api">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow5-3" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="call-update-api" target="update-db">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow5-4" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="update-db" target="return-updated">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow5-5" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="return-updated" target="end-update">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- ChÃº thÃ­ch -->
        <mxCell id="note1" value="Báº£ng email_whitelist:&#xa;â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”&#xa;â”‚ id (PK)                  â”‚&#xa;â”‚ email_hash (UNIQUE)      â”‚ â† SHA-256&#xa;â”‚ email_encrypted          â”‚ â† Plaintext (mÃ£ hÃ³a lÆ°u trá»¯)&#xa;â”‚ added_by                 â”‚&#xa;â”‚ added_at                 â”‚&#xa;â”‚ is_active (BOOLEAN)      â”‚ â† Cho phÃ©p táº¯t táº¡m&#xa;â”‚ notes (TEXT)             â”‚&#xa;â”‚ created_at               â”‚&#xa;â”‚ updated_at               â”‚&#xa;â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜&#xa;&#xa;Indexes:&#xa;â€¢ idx_email_hash (UNIQUE)&#xa;â€¢ idx_is_active (WHERE true)" style="text;html=1;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;whiteSpace=wrap;rounded=1;fontColor=#333333;fontFamily=Courier New;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="40" y="130" width="260" height="250" as="geometry" />
        </mxCell>

        <mxCell id="note2" value="ðŸ”’ Báº£o Máº­t:&#xa;&#xa;âœ“ Email Ä‘Æ°á»£c hash SHA-256 trÆ°á»›c khi&#xa;  so sÃ¡nh Ä‘á»ƒ trÃ¡nh timing attacks&#xa;&#xa;âœ“ Chá»‰ localhost cÃ³ thá»ƒ thÃªm/xÃ³a/update&#xa;  (kiá»ƒm tra IP vÃ  Host header)&#xa;&#xa;âœ“ Email gá»‘c Ä‘Æ°á»£c lÆ°u encrypted&#xa;  Ä‘á»ƒ admin cÃ³ thá»ƒ xem&#xa;&#xa;âœ“ Support cáº£ MySQL vÃ  PostgreSQL&#xa;&#xa;âœ“ Connection pooling vÃ  SSL support" style="text;html=1;strokeColor=#b85450;fillColor=#f8cecc;align=left;verticalAlign=top;whiteSpace=wrap;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="40" y="400" width="280" height="200" as="geometry" />
        </mxCell>

        <mxCell id="note3" value="ðŸ“Š Use Cases:&#xa;&#xa;1ï¸âƒ£ ThÃªm Email:&#xa;   Admin thÃªm email má»›i vÃ o whitelist&#xa;   trÆ°á»›c khi user Ä‘Äƒng nháº­p&#xa;&#xa;2ï¸âƒ£ Kiá»ƒm Tra:&#xa;   Tá»± Ä‘á»™ng check trong OAuth callback&#xa;   Ä‘á»ƒ quyáº¿t Ä‘á»‹nh cho phÃ©p login&#xa;&#xa;3ï¸âƒ£ Quáº£n LÃ½:&#xa;   - Xem danh sÃ¡ch emails&#xa;   - Táº¯t táº¡m (is_active=false)&#xa;   - XÃ³a vÄ©nh viá»…n&#xa;   - ThÃªm ghi chÃº (notes)&#xa;&#xa;4ï¸âƒ£ Audit:&#xa;   Track added_by, added_at, updated_at&#xa;   Ä‘á»ƒ biáº¿t ai thÃªm, khi nÃ o" style="text;html=1;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=top;whiteSpace=wrap;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="40" y="620" width="280" height="280" as="geometry" />
        </mxCell>

        <mxCell id="note4" value="ðŸŒ Localhost Check:&#xa;&#xa;HÃ m isDockerLocalhostIP() kiá»ƒm tra:&#xa;â€¢ 127.0.0.1, ::1, localhost&#xa;â€¢ 127.0.0.0/8 (toÃ n dáº£i 127.x.x.x)&#xa;â€¢ Docker gateway IPs:&#xa;  - 172.17.0.1, 172.18.0.1, ...&#xa;  - 192.168.x.1&#xa;&#xa;â†’ Cho phÃ©p quáº£n lÃ½ tá»« container&#xa;  trong mÃ´i trÆ°á»ng Docker&#xa;&#xa;â†’ Production: nÃªn thÃªm admin auth&#xa;  hoáº·c restrict báº±ng firewall" style="text;html=1;strokeColor=#9673a6;fillColor=#e1d5e7;align=left;verticalAlign=top;whiteSpace=wrap;rounded=1;fontFamily=Courier New;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="40" y="920" width="280" height="200" as="geometry" />
        </mxCell>

        <mxCell id="note5" value="ðŸ’¡ Tips:&#xa;&#xa;â€¢ Äá»ƒ test: thÃªm email cá»§a báº¡n trÆ°á»›c&#xa;  khi thá»­ Ä‘Äƒng nháº­p&#xa;&#xa;â€¢ is_active=false: táº¯t táº¡m khÃ´ng xÃ³a&#xa;  â†’ cÃ³ thá»ƒ báº­t láº¡i sau&#xa;&#xa;â€¢ notes: ghi lÃ½ do thÃªm/táº¯t&#xa;  VD: &quot;CEO company&quot;, &quot;Beta tester&quot;&#xa;&#xa;â€¢ Email khÃ´ng phÃ¢n biá»‡t hoa thÆ°á»ng&#xa;  (normalize trÆ°á»›c khi hash)&#xa;&#xa;â€¢ Backup database thÆ°á»ng xuyÃªn!&#xa;  Máº¥t whitelist = khÃ´ng ai login Ä‘Æ°á»£c" style="text;html=1;strokeColor=#d79b00;fillColor=#ffe6cc;align=left;verticalAlign=top;whiteSpace=wrap;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="40" y="1140" width="280" height="220" as="geometry" />
        </mxCell>

        <mxCell id="note6" value="ðŸ”„ Database Support:&#xa;&#xa;MySQL:&#xa;â€¢ UUID() cho ID&#xa;â€¢ TIMESTAMP DEFAULT CURRENT_TIMESTAMP&#xa;â€¢ ON UPDATE CURRENT_TIMESTAMP&#xa;â€¢ ENGINE=InnoDB&#xa;&#xa;PostgreSQL:&#xa;â€¢ gen_random_uuid() cho ID&#xa;â€¢ TIMESTAMPTZ (timezone aware)&#xa;â€¢ RETURNING clause&#xa;â€¢ Partial indexes (WHERE is_active)&#xa;&#xa;Cáº¥u hÃ¬nh trong config:&#xa;database.type = &quot;mysql&quot; hoáº·c &quot;postgresql&quot;" style="text;html=1;strokeColor=#82b366;fillColor=#d5e8d4;align=left;verticalAlign=top;whiteSpace=wrap;rounded=1;fontFamily=Courier New;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="40" y="1380" width="300" height="260" as="geometry" />
        </mxCell>

        <mxCell id="note7" value="âš¡ Performance:&#xa;&#xa;Read (Check):&#xa;â€¢ Index trÃªn email_hash â†’ O(1) lookup&#xa;â€¢ Query time: ~1-5ms&#xa;â€¢ Cached trong memory náº¿u cáº§n&#xa;&#xa;Write (Add/Update/Delete):&#xa;â€¢ Transaction safe&#xa;â€¢ Index rebuild: ~10-50ms&#xa;â€¢ KhÃ´ng block reads&#xa;&#xa;Scale:&#xa;â€¢ 10K emails: no problem&#xa;â€¢ 100K emails: váº«n nhanh&#xa;â€¢ 1M+ emails: cÃ¢n nháº¯c sharding&#xa;&#xa;Optimization:&#xa;â€¢ Connection pooling (10-50 conns)&#xa;â€¢ Prepared statements&#xa;â€¢ Index-only scans" style="text;html=1;strokeColor=#6c8ebf;fillColor=#dae8fc;align=left;verticalAlign=top;whiteSpace=wrap;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="40" y="1660" width="300" height="280" as="geometry" />
        </mxCell>

        <mxCell id="note8" value="ðŸŽ¯ Best Practices:&#xa;&#xa;âœ… DO:&#xa;â€¢ ThÃªm email trÆ°á»›c khi user thá»­ login&#xa;â€¢ DÃ¹ng is_active thay vÃ¬ xÃ³a ngay&#xa;â€¢ Ghi notes Ä‘á»ƒ nhá»› lÃ½ do&#xa;â€¢ Monitor failed login attempts&#xa;â€¢ Backup whitelist thÆ°á»ng xuyÃªn&#xa;&#xa;âŒ DON'T:&#xa;â€¢ Hardcode emails trong code&#xa;â€¢ Share credentials Ä‘á»ƒ bypass&#xa;â€¢ XÃ³a emails Ä‘ang active&#xa;â€¢ Allow public access to admin APIs&#xa;â€¢ Store passwords in whitelist&#xa;&#xa;ðŸ”§ Production:&#xa;â€¢ ThÃªm admin authentication&#xa;â€¢ Rate limiting cho APIs&#xa;â€¢ Audit logging&#xa;â€¢ Alert khi whitelist changes" style="text;html=1;strokeColor=#d79b00;fillColor=#ffe6cc;align=left;verticalAlign=top;whiteSpace=wrap;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="40" y="1960" width="300" height="340" as="geometry" />
        </mxCell>
