<mxfile host="app.diagrams.net">
  <diagram id="activity-log-flow" name="Activity Log Flow">
    <mxGraphModel dx="1422" dy="794" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />

        <!-- TiÃªu Ä‘á» -->
        <mxCell id="title" value="SÆ¡ Äá»“ Luá»“ng Ghi Nháº­n Hoáº¡t Äá»™ng NgÆ°á»i DÃ¹ng&#xa;(Activity Log Flow)" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=16;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="214" y="20" width="400" height="40" as="geometry" />
        </mxCell>

        <!-- Start -->
        <mxCell id="start" value="Báº¯t Ä‘áº§u" style="ellipse;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="364" y="80" width="100" height="60" as="geometry" />
        </mxCell>

        <!-- NgÆ°á»i dÃ¹ng thá»±c hiá»‡n hÃ nh Ä‘á»™ng -->
        <mxCell id="user-action" value="NgÆ°á»i dÃ¹ng thá»±c hiá»‡n&#xa;hÃ nh Ä‘á»™ng trÃªn há»‡ thá»‘ng&#xa;(view, click, search, etc.)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="334" y="170" width="160" height="70" as="geometry" />
        </mxCell>

        <!-- Frontend capture event -->
        <mxCell id="capture-event" value="Frontend capture event&#xa;vá»›i thÃ´ng tin:&#xa;- action&#xa;- resource_type&#xa;- resource_id" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="334" y="270" width="160" height="80" as="geometry" />
        </mxCell>

        <!-- Gá»i API -->
        <mxCell id="call-api" value="Gá»i POST&#xa;/api/v1/activity-log&#xa;vá»›i log data" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="334" y="380" width="160" height="70" as="geometry" />
        </mxCell>

        <!-- API Server nháº­n request -->
        <mxCell id="api-receive" value="API Server (Go)&#xa;CreateActivityLog&#xa;nháº­n request" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="334" y="480" width="160" height="70" as="geometry" />
        </mxCell>

        <!-- Validate data -->
        <mxCell id="validate" value="Validate dá»¯ liá»‡u:&#xa;- user_id required?&#xa;- user_email required?&#xa;- action required?" style="rhombus;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="319" y="580" width="190" height="110" as="geometry" />
        </mxCell>

        <!-- Invalid -->
        <mxCell id="invalid" value="Tráº£ vá» lá»—i 400&#xa;Missing required fields" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="564" y="605" width="140" height="60" as="geometry" />
        </mxCell>

        <!-- Generate log entry -->
        <mxCell id="generate-entry" value="Táº¡o log entry:&#xa;- ID: timestamp-user_id&#xa;- created_at: RFC3339&#xa;- ip_address: tá»« request&#xa;- user_agent" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="334" y="720" width="160" height="90" as="geometry" />
        </mxCell>

        <!-- XÃ¡c Ä‘á»‹nh file path -->
        <mxCell id="determine-path" value="XÃ¡c Ä‘á»‹nh file path:&#xa;user_logs/{user_id}/&#xa;{date}.json" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="334" y="840" width="160" height="70" as="geometry" />
        </mxCell>

        <!-- Check directory exists -->
        <mxCell id="check-dir" value="ThÆ° má»¥c&#xa;user_logs/{user_id}&#xa;cÃ³ tá»“n táº¡i?" style="rhombus;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="319" y="940" width="190" height="110" as="geometry" />
        </mxCell>

        <!-- Táº¡o thÆ° má»¥c -->
        <mxCell id="create-dir" value="Táº¡o thÆ° má»¥c má»›i&#xa;user_logs/{user_id}&#xa;(permissions: 0755)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="564" y="965" width="140" height="60" as="geometry" />
        </mxCell>

        <!-- Äá»c file hiá»‡n táº¡i -->
        <mxCell id="read-file" value="Äá»c file JSON&#xa;{date}.json&#xa;(náº¿u cÃ³)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="334" y="1080" width="160" height="60" as="geometry" />
        </mxCell>

        <!-- Parse existing logs -->
        <mxCell id="parse-logs" value="Parse danh sÃ¡ch&#xa;logs hiá»‡n táº¡i&#xa;(hoáº·c táº¡o má»›i [])" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="334" y="1170" width="160" height="70" as="geometry" />
        </mxCell>

        <!-- Append log -->
        <mxCell id="append-log" value="Append log entry má»›i&#xa;vÃ o danh sÃ¡ch logs" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="334" y="1270" width="160" height="60" as="geometry" />
        </mxCell>

        <!-- Serialize to JSON -->
        <mxCell id="serialize" value="Serialize thÃ nh JSON&#xa;vá»›i format:&#xa;{date, logs: [...]}" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="334" y="1360" width="160" height="70" as="geometry" />
        </mxCell>

        <!-- Ghi file -->
        <mxCell id="write-file" value="Ghi file&#xa;{date}.json&#xa;(permissions: 0644)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="334" y="1460" width="160" height="70" as="geometry" />
        </mxCell>

        <!-- Check write success -->
        <mxCell id="check-write" value="Ghi file&#xa;thÃ nh cÃ´ng?" style="rhombus;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="339" y="1560" width="150" height="100" as="geometry" />
        </mxCell>

        <!-- Write failed -->
        <mxCell id="write-failed" value="Tráº£ vá» lá»—i 500&#xa;Failed to write log file" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="564" y="1580" width="140" height="60" as="geometry" />
        </mxCell>

        <!-- Return success -->
        <mxCell id="return-success" value="Tráº£ vá» 201 Created&#xa;vá»›i log entry data" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="334" y="1690" width="160" height="60" as="geometry" />
        </mxCell>

        <!-- Frontend nháº­n response -->
        <mxCell id="frontend-response" value="Frontend nháº­n response&#xa;vÃ  cáº­p nháº­t UI&#xa;(náº¿u cáº§n)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="334" y="1780" width="160" height="70" as="geometry" />
        </mxCell>

        <!-- End success -->
        <mxCell id="end-success" value="HoÃ n táº¥t&#xa;ghi log" style="ellipse;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="364" y="1880" width="100" height="60" as="geometry" />
        </mxCell>

        <!-- End fail -->
        <mxCell id="end-fail" value="Ghi log&#xa;tháº¥t báº¡i" style="ellipse;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="584" y="1700" width="100" height="60" as="geometry" />
        </mxCell>

        <!-- Arrows -->
        <mxCell id="arrow1" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="start" target="user-action">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow2" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="user-action" target="capture-event">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow3" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="capture-event" target="call-api">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow4" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="call-api" target="api-receive">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow5" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="api-receive" target="validate">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow6" value="KhÃ´ng há»£p lá»‡" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="validate" target="invalid">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow7" value="Há»£p lá»‡" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="validate" target="generate-entry">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow8" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="invalid" target="end-fail">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="634" y="1730" />
            </Array>
          </mxGeometry>
        </mxCell>

        <mxCell id="arrow9" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="generate-entry" target="determine-path">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow10" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="determine-path" target="check-dir">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow11" value="KhÃ´ng" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="check-dir" target="create-dir">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow12" value="CÃ³" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="check-dir" target="read-file">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow13" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="create-dir" target="read-file">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="634" y="1050" />
              <mxPoint x="520" y="1050" />
              <mxPoint x="520" y="1110" />
            </Array>
          </mxGeometry>
        </mxCell>

        <mxCell id="arrow14" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="read-file" target="parse-logs">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow15" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="parse-logs" target="append-log">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow16" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="append-log" target="serialize">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow17" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="serialize" target="write-file">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow18" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="write-file" target="check-write">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow19" value="KhÃ´ng" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="check-write" target="write-failed">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow20" value="CÃ³" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="check-write" target="return-success">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow21" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="write-failed" target="end-fail">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow22" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="return-success" target="frontend-response">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow23" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="frontend-response" target="end-success">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- ChÃº thÃ­ch -->
        <mxCell id="note1" value="ChÃº thÃ­ch:&#xa;- Há»™p xanh dÆ°Æ¡ng: Frontend&#xa;- Há»™p vÃ ng: API Server (Go)&#xa;- Há»™p tÃ­m: File System Operations&#xa;&#xa;Log Structure:&#xa;{&#xa;  date: &quot;2024-01-15&quot;,&#xa;  logs: [&#xa;    {id, user_id, action, ...}&#xa;  ]&#xa;}" style="text;html=1;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;whiteSpace=wrap;rounded=1;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="40" y="80" width="240" height="190" as="geometry" />
        </mxCell>

        <mxCell id="note2" value="File Organization:&#xa;user_logs/&#xa;  â”œâ”€â”€ {user_id_1}/&#xa;  â”‚   â”œâ”€â”€ 2024-01-15.json&#xa;  â”‚   â”œâ”€â”€ 2024-01-16.json&#xa;  â”‚   â””â”€â”€ ...&#xa;  â”œâ”€â”€ {user_id_2}/&#xa;  â”‚   â””â”€â”€ ...&#xa;&#xa;Má»—i file chá»©a logs cá»§a&#xa;1 user trong 1 ngÃ y" style="text;html=1;strokeColor=#9673a6;fillColor=#e1d5e7;align=left;verticalAlign=top;whiteSpace=wrap;rounded=1;fontFamily=Courier New;" vertex="1" parent="1">
          <mxGeometry x="40" y="290" width="240" height="190" as="geometry" />
        </mxCell>

        <mxCell id="note3" value="Loáº¡i Actions:&#xa;â€¢ page_view: xem trang&#xa;â€¢ item_click: click sáº£n pháº©m&#xa;â€¢ search: tÃ¬m kiáº¿m&#xa;â€¢ recommendation_view&#xa;â€¢ add_to_cart&#xa;â€¢ purchase&#xa;â€¢ rating&#xa;&#xa;Resource Types:&#xa;â€¢ product, user, page, etc." style="text;html=1;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=top;whiteSpace=wrap;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="40" y="500" width="240" height="200" as="geometry" />
        </mxCell>

        <mxCell id="note4" value="Query APIs:&#xa;&#xa;GET /activity-log/user?user_id={id}&#xa;â†’ Láº¥y logs cá»§a 1 user&#xa;&#xa;GET /activity-log/recent?limit=50&#xa;â†’ Láº¥y logs gáº§n Ä‘Ã¢y cá»§a táº¥t cáº£&#xa;&#xa;GET /activity-log/resource?&#xa;    resource_type={type}&amp;&#xa;    resource_id={id}&#xa;â†’ Láº¥y logs theo resource&#xa;&#xa;GET /activity-log/export?user_id={id}&#xa;â†’ Export toÃ n bá»™ logs" style="text;html=1;strokeColor=#82b366;fillColor=#d5e8d4;align=left;verticalAlign=top;whiteSpace=wrap;rounded=1;fontFamily=Courier New;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="40" y="720" width="240" height="200" as="geometry" />
        </mxCell>

        <mxCell id="note5" value="Performance:&#xa;âœ“ Write: O(1) append operation&#xa;âœ“ File per day: giá»›i háº¡n kÃ­ch thÆ°á»›c&#xa;âœ“ Indexed by user_id: query nhanh&#xa;&#xa;Security:&#xa;âœ“ Hash email trÆ°á»›c khi log&#xa;âœ“ IP address Ä‘Æ°á»£c capture&#xa;âœ“ User agent tracking&#xa;&#xa;Privacy:&#xa;âœ“ Sensitive data khÃ´ng lÆ°u&#xa;âœ“ CÃ³ thá»ƒ export/delete theo GDPR" style="text;html=1;strokeColor=#b85450;fillColor=#f8cecc;align=left;verticalAlign=top;whiteSpace=wrap;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="40" y="940" width="240" height="220" as="geometry" />
        </mxCell>

        <mxCell id="note6" value="Use Cases:&#xa;ðŸ“Š Analytics: phÃ¢n tÃ­ch hÃ nh vi user&#xa;ðŸ” Debugging: trace user actions&#xa;ðŸ“ˆ Recommendations: input cho ML&#xa;ðŸ” Audit: kiá»ƒm tra báº£o máº­t&#xa;ðŸ“‰ Business Intelligence" style="text;html=1;strokeColor=#d79b00;fillColor=#ffe6cc;align=left;verticalAlign=top;whiteSpace=wrap;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="40" y="1180" width="240" height="130" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
